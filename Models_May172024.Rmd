---
title: 'Running Models'
author: "Michelle Schultze"
date: "2024-05-17"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r packages, message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(readr)
library(readxl)
library(naniar)
#install.packages("readr", repos = "http://cran.us.r-project.org")
#install.packages("microsynth", repos = "http://cran.us.r-project.org")
#install.packages("LowRankQP", repos = "http://cran.us.r-project.org")
library("readr")
library("microsynth")
library("LowRankQP")
#install.packages("plm")
library(plm)

setwd('/Users/michelleschultze/ukr2024')
data0 <- read_csv("data/NEWDATA_May172024.csv") #no NAs, range 2010-2019
data <- read_csv("data/FULLDATA_NAs_May242024.csv") #NAs, range 2000-2019
```


Add in PPP GDP & per capita measures from WB, plus the correct deflator.
```{r ppp, message=FALSE, warning=FALSE}
#deleted header rows with metadata to allow for easy import
ppp_pc <- read_csv("data/gdp_ppp_per capita_constantUSD.csv")
ppp <- read_csv("data/gdp_ppp_constantUSD.csv")
gdp_deflator <- read_csv("data/gdp_deflator.csv")

#let's pivot and merge these together
ppp <- ppp %>%
  pivot_longer(cols = where(is.numeric), names_to = "year") %>%
  mutate(value = as.numeric(value)) %>%
  filter(!is.na(value)) %>%
  select(1,3, year, value) %>%
  mutate(year = as.numeric(year))

ppp_pc <- ppp_pc %>%
  pivot_longer(cols = where(is.numeric), names_to = "year") %>%
  mutate(value = as.numeric(value)) %>%
  filter(!is.na(value)) %>%
  select(1,3, year, value) %>%
  mutate(year = as.numeric(year))

gdp_deflator <- gdp_deflator %>%
  pivot_longer(cols = 5:28, names_to = "year") %>%
  mutate(value = as.numeric(value)) %>%
  filter(!is.na(value)) %>%
  mutate(year = as.numeric(year),
         `Indicator Name` = `Series Name`) %>%
  select(3, year, value, 7) 

ppp <- ppp %>% 
  full_join(ppp_pc) %>%
  full_join(gdp_deflator) %>%
  group_by(`Country Name`, year, `Indicator Name`) %>%
  summarise_all(~ if (any(!is.na(.))) .[!is.na(.)][1] else NA)


colnames(ppp) <- c("Country.Name", "year", "Indicator.Name", "value")

ppp <- ppp %>%
  pivot_wider(names_from = Indicator.Name, values_from = value) 

#standardize names:
ppp <- ppp %>%
  mutate(Country.Name = case_when(
    Country.Name == "Democratic Republic of the Congo" ~ "Congo, Dem. Rep.",
    Country.Name == "Congo" ~ "Congo, Dem. Rep.",
    Country.Name == "Bahamas" ~ "Bahamas, The",
    Country.Name == "Cape Verde" ~ "Cabo Verde",
    Country.Name == "Czech Republic" ~ "Czechia",
    Country.Name == "East Timor" ~ "Timor-Leste",
    Country.Name == "Egypt" ~ "Egypt, Arab Rep.",
    Country.Name == "Gambia" ~ "Gambia, The", 
    Country.Name == "Guinea Bissau" ~ "Guinea-Bissau",
    Country.Name == "Iran" ~ "Iran, Islamic Rep.",
    Country.Name == "Ivory Coast (Cote d'Ivoire)" ~ "Cote d'Ivoire",
    Country.Name == "Kyrgyzstan" ~ "Kyrgyz Republic", 
    Country.Name == "Laos" ~ "Lao PDR",
    Country.Name == "Macedonia" ~ "North Macedonia",
    Country.Name == "Micronesia" ~ "Micronesia, Fed. Sts.",
    Country.Name == "North Korea" ~ "Korea, Dem. People's Rep.", 
    Country.Name == "Saint Kitts and Nevis" ~ "St. Kitts and Nevis",
    Country.Name == "Saint Lucia" ~ "St. Lucia",
    Country.Name == "Saint Vincent and Grenadines" ~ "St. Vincent and the Grenadines",
    Country.Name == "Saint Vincent and the Grenadines" ~ "St. Vincent and the Grenadines",
    Country.Name == "Slovakia" ~ "Slovak Republic",
    Country.Name == "South Korea" ~ "Korea, Rep.",
    Country.Name == "Swaziland" ~ "Eswatini",
    Country.Name == "Syria" ~ "Syrian Arab Republic",
    Country.Name == "Yemen" ~ "Yemen, Rep.",
    Country.Name == "Vietnam" ~ "Viet Nam",
    Country.Name == "Venezuela" ~ "Venezuela, RB",
    Country.Name == "Turkey" ~ "Turkiye",
    Country.Name == "Hong Kong (SAR)" ~ "Hong Kong SAR, China",
    Country.Name == "Macau (SAR)" ~ "Macao SAR, China",
    Country.Name == "Brunei" ~ "Brunei Darussalam",
    Country.Name == "West Bank and Gaza" ~ "Palestine",
    Country.Name == "Saint Martin" ~ "St. Martin (French part)",
    Country.Name == "Saint-Martin" ~ "St. Martin (French part)",
    Country.Name == "Sint Maarten" ~ "Sint Maarten (Dutch part)",
    Country.Name == "Saint-Barthelemy" ~ "Saint Barthelemy",
    Country.Name == "Russian Federation" ~ "Russia",
    Country.Name == "Iran, Islamic Rep." ~ "Iran",
    Country.Name == "Brunei Darussalam" ~ "Brunei",
    Country.Name == "Congo (Kinshasa)" ~ "Congo, Dem. Rep.",
    Country.Name == "Congo (Brazaville)" ~ "Congo, Rep.",
    Country.Name == "Democratic Republic of Congo" ~ "Congo, Dem. Rep.",
    Country.Name == "Republic of Congo" ~ "Congo, Rep.",
    Country.Name == "Czech Republic" ~ "Czechia",
    Country.Name == "Egypt, Arab Rep." ~ "Egypt",
    Country.Name == "Hong Kong SAR, China" ~ "Hong Kong",
    Country.Name == "Ivory Coast" ~ "Cote d'Ivoire",
    Country.Name == "Lao PDR" ~ "Laos", 
    Country.Name == "Macao SAR, China" ~ "Macau",
    Country.Name == "Macedonia" ~ "North Macedonia",
    Country.Name == "Slovak Republic" ~ "Slovakia",
    Country.Name == "South Korea" ~ "Korea, Rep.",
    Country.Name == "North Korea" ~ "Korea, Dem. People's Rep.",
    Country.Name == "Syrian Arab Republic" ~ "Syria",
    Country.Name == "Turkey" ~ "Turkiye",
    Country.Name == "Venezuela, RB" ~ "Venezuela",
    Country.Name == "Viet Nam" ~ "Vietnam",
    Country.Name == "Kyrgyz Republic" ~ "Kyrgyzstan",
    Country.Name == "Yemen, Rep." ~ "Yemen",
    TRUE ~ Country.Name)
  ) %>%
  filter(!(Country.Name %in% c("European Union", "Latin America & Caribbean", "Latin America & Caribbean (excluding high income)", "South Asia", "Sub-Saharan Africa (excluding high income)", "Grenada and South Grenadines", "Saint Helena, Ascension and Tristan da Cunha", "U.S.S.R.", "West Germany"))) 
  #no need to delete aggregated entities (ie. "West Africa") — they'll drop when we merge with the main dataframe!

data <- data %>%
  left_join(ppp, by = c("Country.Name", "year"))
```

*Now deprecated: Addressing that the nominal GDP measures are different*
We will use real FDI as the Y instead to undercut any potential spurious correlation from inflation trends.
Since I couldn't find nominal GDP data in constant 2017 international$, we'll fix the nominal GDP variable using the GDP deflator: we want both GDP terms to be in the same terms (constant 2017 $international).
```{r}
# GDP deflator = nominal/real * 100
# nominal = real * deflator/100

data <- data %>%
  mutate(total_GDP_n_ID = (`GDP, PPP (constant 2017 international $)` * `GDP deflator (base year varies by country)` /100))

#before reporting, check that this is the proper way to do this. (says "inflation" in the title of the variable which doesn't sound like what we want? But this is supposed to be the GDP deflator.. )
# chatgpt confirms √: mutate(Nominal_GDP = GDP_PPP * (GDP_deflator / 100))
```

After running subsequent models with different nominal GDP measurements, they generate different results. Let's study the difference between the international$ and USD versions of nominal GDP. This chart represents the massive differences between the nominal FDI numbers that we can use in the models.
```{r}
data %>%
  ggplot(mapping = aes(x = total_GDP_n_ID, y = `GDP.current.US$`)) +
  geom_point() +
  labs(title = "Comparing nominal GDP measures", subtitle = "Both generated using World Bank data", x = "Nominal GDP in terms of constant 2017 international$, converted using deflator", y = "Nominal GDP in terms of current US$, imported directly")

data %>%
  ggplot(mapping = aes(x = log(total_GDP_n_ID), y = log(`GDP.current.US$`))) +
  geom_point() +
  labs(title = "Comparing LOGGED nominal GDP measures", subtitle = "Both generated using World Bank data", x = "Nominal GDP in terms of constant 2017 international$, converted using deflator", y = "Nominal GDP in terms of current US$, imported directly")
```
*end of deprecated portion*

Create some logged variables:
```{r vars, message=FALSE, warning=FALSE}
data <- data %>% 
  mutate(total_FDI_n = (Foreign.direct.investment.net.inflows.pct.of.GDP * `GDP.current.US$` / 100),
         total_FDI_r = (Foreign.direct.investment.net.inflows.pct.of.GDP * `GDP, PPP (constant 2017 international $)` / 100),
    log_FDI_n = log1p(total_FDI_n),
    log_FDI_r = log1p(total_FDI_r),
    ihs_FDI_n = asinh(total_FDI_n),
    ihs_FDI_r = asinh(total_FDI_r),
    log_GDP_n = log1p(`GDP.current.US$`),
    log_GDP_r = log1p(`GDP, PPP (constant 2017 international $)`),
    log_GDP_r_pc = log1p(`GDP per capita, PPP (constant 2017 international $)`),
    log_battle = log1p(fatalities.y.Battles))
```

We can switch between the two nominal GDP measures by trading total_GDP_n_ID for `GDP.current.US$` (and vice versa).

Guide to new variables:
total_FDI_n = nominal total FDI (using GDP in constant 2017 international$, which was calculated using GDP deflator from PPP measures)
total_FDI_r = real total FDI (from PPP GDP numbers in current $US)
log_FDI_n = nominal total FDI, with log+1 transformation
log_FDI_r = real total FDI, with log+1 transformation
ihs_FDI_n = nominal total FDI, with IHS transformation
ihs_FDI_r = real total FDI, with IHS transformation
log_GDP_n = nominal GDP, logged+1
log_GDP_r = real GDP, logged+1
log_GDP_r_pc = real GDP per capita, logged+1
log_battle = battle fatalities, logged+1

Descriptive stats:
```{r}
glimpse(data)
unique(data$Country.Name)
data %>%
  summarize(min = min(year),
            max = max(year))
```

We have some outliers with Hungary (2018) and Azerbaijan (2014) with high spikes in passengers flying into the country. This seems to be measurement error. Let's cut them from the dataset.
```{r filter message=FALSE, warning=FALSE}
data %>%
  ggplot(mapping = aes(x = year, y = passengers.in.change.pct)) +
  geom_point() +
  labs(title = "Change in passengers flying into the country", subtitle = "Outliers with Hungary (2018) and Azerbaijan (2014), likely measurement error.")

data <- data %>% 
  filter(Country.Name != "Azerbaijan",
         Country.Name != "Hungary")
```

```{r}
data %>%
  ggplot(mapping = aes(x = year, y = passengers.in.change.pct)) +
  geom_point() +
  labs(title = "Change in passengers flying into the country (cont.)", subtitle = "After removing outliers, still some high outliers emerge.")
```

```{r}
sums <- data %>%
  group_by(Country.Name) %>%
  summarize(min_year = min(year),
            max_year = max(year),
            range_years = (max(year) - min(year)),
            min_FDI_n = min(total_FDI_n),
            max_FDI_n = max(total_FDI_n),
            range_FDI_n = (max(total_FDI_n) - min(total_FDI_n)),
            min_FDI_r = min(total_FDI_r),
            max_FDI_r = max(total_FDI_r),
            range_FDI_r = (max(total_FDI_r) - min(total_FDI_r)),
            min_pass = min(passengers.in.change.pct),
            max_pass = max(passengers.in.change.pct),
            range_pass = (max(passengers.in.change.pct) - min(passengers.in.change.pct)))

sums
```

```{r}
sums %>%
  ggplot(mapping = aes(x = min_pass, y = max_pass)) +
  geom_point() +
  labs(title = "Min and max of the 'percent change in passengers' variable", subtitle = "It looks like countries have strong spikes and decreases reported... measurement error or real?")
```

```{r}
sums %>%
  ggplot(mapping = aes(y = range_years)) +
    geom_bar() +
  labs(title = "Year ranges in the full dataset", subtitle = "Most countries have the full range of data N=19")

data %>%
  ggplot(mapping = aes(x = year, y = total_FDI_r, color = "Real FDI", alpha = 0.5)) +
  geom_point() +
  geom_point(data = data, mapping = aes(x = year, y = total_FDI_n, color = "Nominal FDI", alpha = 0.5)) +
  labs(title = "FDI levels over time", subtitle = "Clustered somewhere above zero.")

data %>%
  ggplot(mapping = aes(x = year, y = ihs_FDI_r, color = "IHS-transformed real FDI", alpha = 0.5)) +
  geom_point() +
  geom_point(data = data, mapping = aes(x = year, y = ihs_FDI_n, color = "IHS-transformed nominal FDI", alpha = 0.5)) +
  labs(title = "IHS-transformed  FDI levels over time", subtitle = "Clustered somewhere above zero.")

sums %>%
  ggplot(mapping = aes(x = range_FDI_r, y = range_FDI_n)) +
  geom_point() +
  labs(title = "FDI ranges compared", subtitle = "The ratio between nominal and real FDI is not equal between all countries, but they are similar.")

sums %>%
  ggplot(mapping = aes(x = log(range_FDI_r), y = log(range_FDI_n))) +
  geom_point() +
  labs(title = "Logged FDI ranges compared", subtitle = "Nominal and real FDI differences are even more smoothed out through logs (or IHS).")
```

Models we would like to run:

No FE: 
(1a) FDI = pass + ε
ihs(total real FDI) = lag(percentage change in passengers flying in)
(2a) FDI = pass + ACLED + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(ACLED battle deaths))
(3a) FDI = pass + ACLED + real GDP + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths))
(4a) FDI = pass + ACLED + real GDP per capita + ε 
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(ACLED battle deaths)) + lag(log(real GDP per capita, PPP))
(5a) FDI = pass + ACLED + nominal GDP int$ + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) +  lag(log(ACLED battle deaths)) + lag(log(nominal GDP in int$ constant 2017))
(6a) FDI = pass + ACLED + nominal GDP US$ + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) +  lag(log(ACLED battle deaths)) + lag(log(nominal GDP in USD current))
(7a) FDI = pass + ACLED + real GDP per capita + inflation deflator + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths)) + lag(inflation_rate)
(8a) FDI = pass + ACLED + real GDP per capita + inflation deflator + GDP growth + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths)) + lag(inflation_rate) + lag(GDP.growth.annual.pct)

MODELS

IHS-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct), data = data)
models[["IHS-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["IHS-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data)
models[["IHS-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["IHS-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data)
models[["IHS-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["IHS-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data)
models[["IHS-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["IHS-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data)
models[["IHS-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["IHS-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data)
models[["IHS-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["IHS-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data)
models[["IHS-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["IHS-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data)
models[["IHS-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["IHS-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "IHS-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```
Source: https://stackoverflow.com/questions/62610249/modelsummary-kableextra-regression-table-with-models-of-the-same-name 

Log-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_r ~ lag(passengers.in.change.pct), data = data)
models[["Log-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data)
models[["Log-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data)
models[["Log-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data)
models[["Log-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data)
models[["Log-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data)
models[["Log-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data)
models[["Log-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data)
models[["Log-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Nominal FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_n ~ lag(passengers.in.change.pct), data = data)
models[["Log-Transformed Nominal FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Nominal FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle), data = data)
models[["Log-Transformed Nominal FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Nominal FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data)
models[["Log-Transformed Nominal FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Nominal FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data)
models[["Log-Transformed Nominal FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Nominal FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data)
models[["Log-Transformed Nominal FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Nominal FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data)
models[["Log-Transformed Nominal FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Nominal FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data)
models[["Log-Transformed Nominal FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Nominal FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data)
models[["Log-Transformed Nominal FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Nominal FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Nominal FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```





***Just Europe***

Just European countries:
```{r}
data_Eur <- data %>%
  filter(Country.Name %in% c("Armenia", "Austria", "Belarus", "Belgium", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czechia", "Denmark", "Estonia", "Finland", "France", "Georgia", "Germany", "Greece", "Iceland", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Moldova", "Netherlands", "North Macedonia", "Norway", "Poland", "Portugal", "Romania", "Russia", "Serbia", "Slovenia", "Spain", "Sweden", "Switzerland",  "Turkiye", "Ukraine", "United Kingdom"))
unique(data_Eur$Country.Name)
```

Repeat some of the descriptive stats here:

```{r}
data_Eur %>%
  ggplot(mapping = aes(x = year, y = passengers.in.change.pct)) +
  geom_point() +
  labs(title = "Change in passengers flying into the country (Eur)", subtitle = "Europe has a similar pattern to the rest of the world.")
```

```{r}
sums <- data_Eur %>%
  group_by(Country.Name) %>%
  summarize(min_year = min(year),
            max_year = max(year),
            range_years = (max(year) - min(year)),
            min_FDI_n = min(total_FDI_n),
            max_FDI_n = max(total_FDI_n),
            range_FDI_n = (max(total_FDI_n) - min(total_FDI_n)),
            min_FDI_r = min(total_FDI_r),
            max_FDI_r = max(total_FDI_r),
            range_FDI_r = (max(total_FDI_r) - min(total_FDI_r)),
            min_pass = min(passengers.in.change.pct),
            max_pass = max(passengers.in.change.pct),
            range_pass = (max(passengers.in.change.pct) - min(passengers.in.change.pct)))

sums
```

```{r}
sums %>%
  ggplot(mapping = aes(x = min_pass, y = max_pass)) +
  geom_point() +
  labs(title = "Min and max of the 'percent change in passengers' variable", subtitle = "Similar pattern to the rest of the world.")
```

```{r}
sums %>%
  ggplot(mapping = aes(y = range_years)) +
    geom_bar() +
  labs(title = "Year ranges in the full dataset", subtitle = "Even more countries have the full range of data N=19")

data_Eur %>%
  ggplot(mapping = aes(x = year, y = total_FDI_r, color = "Real FDI", alpha = 0.5)) +
  geom_point() +
  geom_point(data = data, mapping = aes(x = year, y = total_FDI_n, color = "Nominal FDI", alpha = 0.5)) +
  labs(title = "FDI levels over time (Eur)", subtitle = "Clustered somewhere above zero.")

sums %>%
  ggplot(mapping = aes(x = range_FDI_r, y = range_FDI_n)) +
  geom_point() +
  labs(title = "FDI ranges compared (Eur)", subtitle = "The ratio between nominal and real FDI is even more similar.")

sums %>%
  ggplot(mapping = aes(x = log(range_FDI_r), y = log(range_FDI_n))) +
  geom_point() +
  labs(title = "Logged FDI ranges compared (Eur)", subtitle = "Nominal and real FDI differences are smoothed out through logs.")
```

MODELS

IHS-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["IHS-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["IHS-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["IHS-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["IHS-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["IHS-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["IHS-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["IHS-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_Eur)
models[["IHS-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["IHS-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "IHS-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_r ~ lag(passengers.in.change.pct), data = data_Eur)
models[["Log-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_Eur)
models[["Log-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_Eur)
models[["Log-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_Eur)
models[["Log-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_Eur)
models[["Log-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_Eur)
models[["Log-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_Eur)
models[["Log-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_Eur)
models[["Log-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Nominal FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_n ~ lag(passengers.in.change.pct), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Nominal FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Nominal FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Nominal FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Nominal FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Nominal FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Nominal FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Nominal FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_Eur)
models[["Log-Transformed Nominal FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Nominal FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Nominal FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```





***Just Middle Income Countries***

Just Middle Income countries:
```{r}
data_MI <- data %>%
  filter(Country.Name %in% c("Algeria", "Angola", "Bangladesh", "Benin", "Bhutan", "Bolivia", "Cabo Verde", "Cambodia", "Cameroon", "Comoros", "Congo, Rep.", "Côte d'Ivoire", "Djibouti", "Egypt", "Eswatini", "Ghana", "Guinea", "Haiti", "Honduras", "India", "Iran", "Jordan", "Kenya", "Kiribati", "Kyrgyz Republic", "Lao PDR", "Lebanon", "Lesotho", "Mauritania", "Micronesia", "Mongolia", "Morocco", "Myanmar", "Nepal", "Nicaragua", "Nigeria", "Pakistan", "Papua New Guinea", "Philippines", "Samoa", "São Tomé and Príncipe", "Senegal", "Solomon Islands", "Sri Lanka", "Tajikistan", "Tanzania", "Timor-Leste", "Tunisia", "Ukraine", "Uzbekistan", "Vanuatu", "Vietnam", "Zambia", "Zimbabwe", "Albania", "Argentina", "Armenia", "Azerbaijan", "Belarus", "Belize", "Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "China", "Colombia", "Costa Rica", "Cuba", "Dominica", "Dominican Republic", "Ecuador", "El Salvador", "Equatorial Guinea", "Fiji", "Gabon", "Georgia", "Grenada", "Guatemala", "Indonesia", "Iraq", "Jamaica", "Kazakhstan", "Kosovo", "Libya", "Malaysia", "Maldives", "Marshall Islands", "Mauritius", "Mexico", "Moldova", "Montenegro", "Namibia", "North Macedonia", "Palau", "Paraguay", "Peru", "Russian Federation", "Serbia", "South Africa", "St. Lucia", "St. Vincent and the Grenadines", "Suriname", "Thailand", "Tonga", "Türkiye", "Turkmenistan", "Tuvalu"))
unique(data_MI$Country.Name)
```

Repeat some of the descriptive stats here:

```{r}
data_MI %>%
  ggplot(mapping = aes(x = year, y = passengers.in.change.pct)) +
  geom_point() +
  labs(title = "Change in passengers flying into the country (Eur)", subtitle = "MI Countries have wider variation.")
```

```{r}
sums <- data_MI %>%
  group_by(Country.Name) %>%
  summarize(min_year = min(year),
            max_year = max(year),
            range_years = (max(year) - min(year)),
            min_FDI_n = min(total_FDI_n),
            max_FDI_n = max(total_FDI_n),
            range_FDI_n = (max(total_FDI_n) - min(total_FDI_n)),
            min_FDI_r = min(total_FDI_r),
            max_FDI_r = max(total_FDI_r),
            range_FDI_r = (max(total_FDI_r) - min(total_FDI_r)),
            min_pass = min(passengers.in.change.pct),
            max_pass = max(passengers.in.change.pct),
            range_pass = (max(passengers.in.change.pct) - min(passengers.in.change.pct)))

sums
```

```{r}
sums %>%
  ggplot(mapping = aes(x = min_pass, y = max_pass)) +
  geom_point() +
  labs(title = "Min and max of the 'percent change in passengers' variable", subtitle = "Slightly more variation than the rest of the world.")
```

```{r}
sums %>%
  ggplot(mapping = aes(y = range_years)) +
    geom_bar() +
  labs(title = "Year ranges in the full dataset", subtitle = "Higher proportion of countries DON'T have the full range of data N=19")

data_MI %>%
  ggplot(mapping = aes(x = year, y = total_FDI_r, color = "Real FDI", alpha = 0.5)) +
  geom_point() +
  geom_point(data = data, mapping = aes(x = year, y = total_FDI_n, color = "Nominal FDI", alpha = 0.5)) +
  labs(title = "FDI levels over time (MI)", subtitle = "Clustered somewhere above zero.")

sums %>%
  ggplot(mapping = aes(x = range_FDI_r, y = range_FDI_n)) +
  geom_point() +
  labs(title = "FDI ranges compared (MI)", subtitle = "The ratio between nominal and real FDI is even more similar.")

sums %>%
  ggplot(mapping = aes(x = log(range_FDI_r), y = log(range_FDI_n))) +
  geom_point() +
  labs(title = "Logged FDI ranges compared (MI)", subtitle = "Nominal and real FDI differences are smoothed out through logs.")
```

MODELS

IHS-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct), data = data_MI)
models[["IHS-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["IHS-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_MI)
models[["IHS-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["IHS-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_MI)
models[["IHS-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["IHS-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_MI)
models[["IHS-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["IHS-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_MI)
models[["IHS-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["IHS-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_MI)
models[["IHS-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["IHS-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_MI)
models[["IHS-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["IHS-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_MI)
models[["IHS-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["IHS-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "IHS-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_r ~ lag(passengers.in.change.pct), data = data_MI)
models[["Log-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_MI)
models[["Log-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_MI)
models[["Log-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_MI)
models[["Log-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_MI)
models[["Log-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_MI)
models[["Log-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_MI)
models[["Log-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_MI)
models[["Log-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Nominal FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_n ~ lag(passengers.in.change.pct), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Nominal FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Nominal FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Nominal FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Nominal FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Nominal FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Nominal FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Nominal FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_MI)
models[["Log-Transformed Nominal FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Nominal FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Nominal FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```







***Just Lower Middle Income Countries***

Just Lower Middle Income countries:
```{r}
data_LMI <- data %>%
  filter(Country.Name %in% c("Algeria", "Angola", "Bangladesh", "Benin", "Bhutan", "Bolivia", "Cabo Verde", "Cambodia", "Cameroon", "Comoros", "Congo, Rep.", "Côte d'Ivoire", "Djibouti", "Egypt", "Eswatini", "Ghana", "Guinea", "Haiti", "Honduras", "India", "Iran", "Jordan", "Kenya", "Kiribati", "Kyrgyz Republic", "Lao PDR", "Lebanon", "Lesotho", "Mauritania", "Micronesia", "Mongolia", "Morocco", "Myanmar", "Nepal", "Nicaragua", "Nigeria", "Pakistan", "Papua New Guinea", "Philippines", "Samoa", "São Tomé and Príncipe", "Senegal", "Solomon Islands", "Sri Lanka", "Tajikistan", "Tanzania", "Timor-Leste", "Tunisia", "Ukraine", "Uzbekistan", "Vanuatu", "Vietnam", "Zambia", "Zimbabwe"))
unique(data_LMI$Country.Name)
```

Repeat some of the descriptive stats here:

```{r}
data_LMI %>%
  ggplot(mapping = aes(x = year, y = passengers.in.change.pct)) +
  geom_point() +
  labs(title = "Change in passengers flying into the country (Eur)", subtitle = "MI Countries have wider variation.")
```

```{r}
sums <- data_LMI %>%
  group_by(Country.Name) %>%
  summarize(min_year = min(year),
            max_year = max(year),
            range_years = (max(year) - min(year)),
            min_FDI_n = min(total_FDI_n),
            max_FDI_n = max(total_FDI_n),
            range_FDI_n = (max(total_FDI_n) - min(total_FDI_n)),
            min_FDI_r = min(total_FDI_r),
            max_FDI_r = max(total_FDI_r),
            range_FDI_r = (max(total_FDI_r) - min(total_FDI_r)),
            min_pass = min(passengers.in.change.pct),
            max_pass = max(passengers.in.change.pct),
            range_pass = (max(passengers.in.change.pct) - min(passengers.in.change.pct)))

sums
```

```{r}
sums %>%
  ggplot(mapping = aes(x = min_pass, y = max_pass)) +
  geom_point() +
  labs(title = "Min and max of the 'percent change in passengers' variable", subtitle = "Much more variation than the rest of the world.")
```

```{r}
sums %>%
  ggplot(mapping = aes(y = range_years)) +
    geom_bar() +
  labs(title = "Year ranges in the full dataset", subtitle = "Higher proportion of countries DON'T have the full range of data N=19")

data_LMI %>%
  ggplot(mapping = aes(x = year, y = total_FDI_r, color = "Real FDI", alpha = 0.5)) +
  geom_point() +
  geom_point(data = data, mapping = aes(x = year, y = total_FDI_n, color = "Nominal FDI", alpha = 0.5)) +
  labs(title = "FDI levels over time (MI)", subtitle = "Clustered somewhere above zero.")

sums %>%
  ggplot(mapping = aes(x = range_FDI_r, y = range_FDI_n)) +
  geom_point() +
  labs(title = "FDI ranges compared (MI)", subtitle = "The ratio between nominal and real FDI is even more similar.")

sums %>%
  ggplot(mapping = aes(x = log(range_FDI_r), y = log(range_FDI_n))) +
  geom_point() +
  labs(title = "Logged FDI ranges compared (MI)", subtitle = "Nominal and real FDI differences are smoothed out through logs.")
```

MODELS

IHS-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["IHS-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["IHS-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["IHS-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["IHS-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["IHS-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["IHS-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["IHS-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(ihs_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_LMI)
models[["IHS-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["IHS-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "IHS-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Real FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_r ~ lag(passengers.in.change.pct), data = data_LMI)
models[["Log-Transformed Real FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Real FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_LMI)
models[["Log-Transformed Real FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Real FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_LMI)
models[["Log-Transformed Real FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Real FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_LMI)
models[["Log-Transformed Real FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Real FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_LMI)
models[["Log-Transformed Real FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Real FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_LMI)
models[["Log-Transformed Real FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Real FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_LMI)
models[["Log-Transformed Real FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Real FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_r ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_LMI)
models[["Log-Transformed Real FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Real FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Real FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```

Log-Transformed Nominal FDI
```{r}
models <- NA
models <- list()
hsd_testing <- NA
hsd_testing <- list()

model.1a <- lm(log_FDI_n ~ lag(passengers.in.change.pct), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["1a"]] <- model.1a
hsd_testing[["Log-Transformed Nominal FDI"]][["1a"]] <- bptest(model.1a)

model.2a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["2a"]] <- model.2a
hsd_testing[["Log-Transformed Nominal FDI"]][["2a"]] <- bptest(model.2a)

model.3a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["3a"]] <- model.3a
hsd_testing[["Log-Transformed Nominal FDI"]][["3a"]] <- bptest(model.3a)

model.4a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r_pc), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["4a"]] <- model.4a
hsd_testing[["Log-Transformed Nominal FDI"]][["4a"]] <- bptest(model.4a)

model.5a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(total_GDP_n_ID)), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["5a"]] <- model.5a
hsd_testing[["Log-Transformed Nominal FDI"]][["5a"]] <- bptest(model.5a)

model.6a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log1p(`GDP.current.US$`)), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["6a"]] <- model.6a
hsd_testing[["Log-Transformed Nominal FDI"]][["6a"]] <- bptest(model.6a)

model.7a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["7a"]] <- model.7a
hsd_testing[["Log-Transformed Nominal FDI"]][["7a"]] <- bptest(model.7a)

model.8a <- lm(log_FDI_n ~ lag(passengers.in.change.pct) + lag(log_battle) + lag(log_GDP_r) + lag(`Inflation.GDP.deflator.annual.pct`) + lag(GDP.growth.annual.pct), data = data_LMI)
models[["Log-Transformed Nominal FDI"]][["8a"]] <- model.8a
hsd_testing[["Log-Transformed Nominal FDI"]][["8a"]] <- bptest(model.8a)
```

```{r}
models_unlisted <- unlist(models, recursive=FALSE)
names(models_unlisted) <- c('1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a')

cm <- c( '(Intercept)' = 'Constant', 'lag(passengers.in.change.pct)' = 'Change in passengers (%, lag)',
         'lag(log_battle)' = 'Battle fatalities (log)', 'lag(log_GDP_r)' = 'Real GDP (int$, log, lag)',
         'lag(log_GDP_r_pc)' = 'Real GDP per capita (int$, log, lag)',
         'lag(log1p(total_GDP_n_ID))' = 'Nominal GDP (int$, log, lag)',
         'lag(log1p(`GDP.current.US$`))' = 'Nominal GDP (USD, log, lag)',
         'lag(Inflation.GDP.deflator.annual.pct)' = 'Inflation GDP Deflator',
         'lag(GDP.growth.annual.pct)' = 'GDP Growth (%, lag)')

msummary(models_unlisted, output = 'kableExtra', coef_map = cm, stars = TRUE, gof_omit = 'IC|Log|Adj', title = "Log-Transfomed Nominal FDI", statistic = 'p.value', conf_level = 0.95, vcov = 'robust')
```





WITH FIXED EFFECTS
FE included:
(1b) FDI = pass + FE for country + FE for year + ε
ihs(total real FDI) = lag(percentage change in passengers flying in)
(2b) FDI = pass + ACLED + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(ACLED battle deaths))
(3b) FDI = pass + ACLED + real GDP + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths))
(4b) FDI = pass + ACLED + real GDP per capita + FE for country + FE for year +  ε 
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(ACLED battle deaths)) + lag(log(real GDP per capita, PPP))
(5b) FDI = pass + ACLED + nominal GDP int$ + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) +  lag(log(ACLED battle deaths)) + lag(log(nominal GDP in int$ constant 2017))
(6b) FDI = pass + ACLED + nominal GDP US$ + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) +  lag(log(ACLED battle deaths)) + lag(log(nominal GDP in USD current))
(7b) FDI = pass + ACLED + real GDP per capita + inflation deflator + FE for country + FE for year + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths)) + lag(inflation_rate)


(1b) FDI = pass + FE for country + FE for year + ε
ihs(total real FDI) = lag(percentage change in passengers flying in)
```{r}
# Ensure the data is in the correct format for plm (panel data)
test <- pdata.frame(data_Eur, index = c("Country.Name", "year"))

model.1b <- plm(ihs_FDI_r ~ lag(passengers.in.change.pct), data = test, index = c("Country.Name", "year"), model = "within", effect = "twoways")
summary(model.1b)
bptest(model.1b)
```


(2b) FDI = pass + ACLED + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(ACLED battle deaths))
(3b) FDI = pass + ACLED + real GDP + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths))
(4b) FDI = pass + ACLED + real GDP per capita + FE for country + FE for year +  ε 
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(ACLED battle deaths)) + lag(log(real GDP per capita, PPP))
(5b) FDI = pass + ACLED + nominal GDP int$ + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) +  lag(log(ACLED battle deaths)) + lag(log(nominal GDP in int$ constant 2017))
(6b) FDI = pass + ACLED + nominal GDP US$ + FE for country + FE for year +  ε
ihs(total real FDI) = lag(percentage change in passengers flying in) +  lag(log(ACLED battle deaths)) + lag(log(nominal GDP in USD current))
(7b) FDI = pass + ACLED + real GDP per capita + inflation deflator + FE for country + FE for year + ε
ihs(total real FDI) = lag(percentage change in passengers flying in) + lag(log(real total GDP)) + lag(log(ACLED battle deaths)) + lag(inflation_rate)





